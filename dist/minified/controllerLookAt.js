"use strict";Behave3d.controllerLookAt=function(a){Behave3d.Controller.call(this,a)};Behave3d.controllerLookAt.prototype=Object.create(Behave3d.Controller.prototype);Behave3d.controllerLookAt.prototype.events=["start","end"];Behave3d.controllerLookAt.prototype.messages=[];Behave3d.controllerLookAt.prototype.default_params={target_id:"",quickness:0.2,face_angle:0,event_precision:1,target_dz:0};Behave3d.controllerLookAt.prototype.construct=function(a,b){if(b=="params"){this.current_angle=0;this.current_angle_z=0}};Behave3d.controllerLookAt.prototype.update=function(){if(this.paramsHaveChanged())this.computed_params=this.getComputedLengths([],[],["target_dz"]);if(!this.paused){var a=Behave3d.getElementPos(this.owner.element,!0),b=Behave3d.getElementPos(this.target_id,!0),c=Behave3d.getAngle(a,b)+this.face_angle,d=c-this.current_angle;if(d<-Behave3d.consts.ROTATE_ONE_TURN/2)d+=Behave3d.consts.ROTATE_ONE_TURN;if(d>Behave3d.consts.ROTATE_ONE_TURN/2)d-=Behave3d.consts.ROTATE_ONE_TURN;this.current_angle=(Behave3d.consts.ROTATE_ONE_TURN+this.current_angle+d*this.quickness)%Behave3d.consts.ROTATE_ONE_TURN;var e=Math.abs(c-this.current_angle)<this.event_precision,f=Math.abs(d)<this.event_precision;if(this.computed_params.target_dz!=0){var g=b.x-a.x,h=b.y-a.y,i=Math.sqrt(g*g+h*h),c=Behave3d.getAngle({x:0,y:0},{x:this.computed_params.target_dz,y:i}),d=c-this.current_angle_z;if(d<-Behave3d.consts.ROTATE_ONE_TURN/2)d+=Behave3d.consts.ROTATE_ONE_TURN;if(d>Behave3d.consts.ROTATE_ONE_TURN/2)d-=Behave3d.consts.ROTATE_ONE_TURN;this.current_angle_z=(Behave3d.consts.ROTATE_ONE_TURN+this.current_angle_z+d*this.quickness)%Behave3d.consts.ROTATE_ONE_TURN;e=e&&Math.abs(c-this.current_angle_z)<this.event_precision;f=f&&Math.abs(d)<this.event_precision}if(f&&!e)this.fireEvent("start");else if(e&&!f)this.fireEvent("end")}if(this.computed_params.target_dz!=0)this.addTransform({type:Behave3d.transforms.rotate,rx:-Math.sin(this.current_angle/Behave3d.consts.RADIANS_TO_UNITS),ry:Math.cos(this.current_angle/Behave3d.consts.RADIANS_TO_UNITS),rz:0,ra:this.current_angle_z});else this.addTransform({type:Behave3d.transforms.rotate,rx:0,ry:0,rz:1,ra:this.current_angle})};Behave3d.registerController("lookAt",Behave3d.controllerLookAt);