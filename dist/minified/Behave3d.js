"use strict";var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?obj=>typeof obj:obj=>obj&&typeof Symbol=="function"&&obj.constructor===Symbol?"symbol":typeof obj,Behave3d=(a,b)=>{if(b===void 0)b=!0;return Behave3d.selector(a,b)};if(window)window.Behave3d=Behave3d;Behave3d.controllers={};Behave3d.params={};Behave3d.ui={};Behave3d.consts={VERSION:"0.8.3",FRAME_RATE:60,PHYSICS_FRAME_RATE:600,GRAVITY_CONSTANT:400,BEHAVE3D_ATTRIB:"behave3d",BEHAVE3D_PROPERTY:"behave3d",FRAME_TIMER_TYPE:"st",SHORTTERM_FRAME_DURATION_M:0.2,LONGTTERM_FRAME_DURATION_M:0.01,MAX_SUBFRAMES_PER_FRAME:1,SUBFRAMES_PRECISION:0.2,ROTATE_UNIT:"deg",ROTATE_ONE_TURN:360,RADIANS_TO_UNITS:360/(2*Math.PI),PRECISION_TRANSLATE:1,PRECISION_ROTATE:3,PRECISION_ROTATE_ANGLE:1,PRECISION_SCALE:3,PRECISION_OPACITY:2,CSS_TRANSFORMS_PREFIX:"",DEBUG:!!0,DEBUG_STATS_CONTAINER:""};if(window.behave3dConstants)for(window.behave3dConstants.i in window.behave3dConstants){Behave3d.consts[window.behave3dConstants.i]=window.behave3dConstants[window.behave3dConstants.i]}Behave3d.transforms={translate:{dx:0,dy:0,dz:0},scale:{sx:1,sy:1,sz:1},rotate:{rx:0,ry:0,rz:0,ra:0},origin:{ox:0.5,oy:0.5,oz:0},opacity:{opacity:1},flatten:{flatten:!0}};Behave3d.vars={engineIsPaused:!1,frameDuration:1000/Behave3d.consts.FRAME_RATE,frameTimerType:"",frameTimerID:null,sceneParams:{},elementsPool:[],elementsToRemove:[],sceneContainer:null,sceneController:null,uniqueIDCounter:0,delayedInits:!1,unitRem:1,cssPropTransform:"transform",cssPropTransformStyle:"transformStyle",cssPropTransformOrigin:"transformOrigin",cssPropPerspective:"perspective",cssPropPerspectiveOrigin:"perspectiveOrigin",lastFrameTimestamp:0,lastFrameSubframes:1,longTermFrameDuration:0,shortTermFrameDuration:0,mousePosX:0,mousePosY:0,debugInfo:{}};Behave3d.startEngine=()=>{Behave3d.vars.elementsPool=[];Behave3d.vars.frameTimerType=Behave3d.consts.FRAME_TIMER_TYPE;if(Behave3d.vars.frameTimerType=="raf"&&!window.requestAnimationFrame){Behave3d.debugOut("startEngine() falls back to setTimeout() because requestAnimationFrame() is not supported");Behave3d.vars.frameTimerType="st"}Behave3d.vars.frameTimerID=Behave3d.vars.frameTimerType=="raf"?window.requestAnimationFrame(Behave3d.runThisFrame):window.setTimeout(Behave3d.runThisFrame,Behave3d.vars.frameDuration);Behave3d.vars.engineIsPaused=!1;Behave3d.calculateUnits();Behave3d.setCSSPrefixes(Behave3d.consts.CSS_TRANSFORMS_PREFIX);document.addEventListener("mousemove",Behave3d.mouseEventListener,!0);document.addEventListener("touchmove",Behave3d.mouseEventListener,!0)};Behave3d.stopEngine=()=>{if(Behave3d.var.frameTimerType=="raf"){if(window.cancelAnimationFrame)window.cancelAnimationFrame(Behave3d.vars.frameTimerID)}else window.clearTimeout(Behave3d.vars.frameTimerID)};Behave3d.isEnginePaused=()=>Behave3d.vars.engineIsPaused;Behave3d.pauseEngine=a=>{if(a===void 0)a=!Behave3d.vars.engineIsPaused;Behave3d.vars.engineIsPaused=a;Behave3d.debugOut("behave3d engine is "+(a?"":"un")+"paused")};Behave3d.calculateUnits=()=>{if(!document.body)return;var a=document.createElement("div");a.style.boxSizing="border-box";a.style.width="1000rem";document.body.appendChild(a);Behave3d.vars.unitRem=a.offsetWidth/1000;document.body.removeChild(a)};Behave3d.setCSSPrefixes=a=>{function b(c,d){return d==""?c:d+c.substr(0,1).toUpperCase()+c.substr(1)}Behave3d.vars.cssPropTransform=b("transform",a);Behave3d.vars.cssPropTransformStyle=b("transformStyle",a);Behave3d.vars.cssPropTransformOrigin=b("transformOrigin",a);Behave3d.vars.cssPropPerspective=b("perspective",a);Behave3d.vars.cssPropPerspectiveOrigin=b("perspectiveOrigin",a)};Behave3d.setScene=(a,b)=>{if(Array.isArray(a))a=Behave3d.params.getParamsAsObject(a);Behave3d.vars.sceneParams=Behave3d.params.extendObject(Behave3d.vars.sceneParams,a);Behave3d.vars.sceneController=b;Behave3d.vars.sceneContainer=b.owner.element;Behave3d.vars.sceneParams.perspective=Behave3d.params.getLength(Behave3d.vars.sceneParams.perspective,"Z",Behave3d.vars.sceneContainer,!1);Behave3d.vars.sceneContainer.style[Behave3d.vars.cssPropPerspective]=Behave3d.vars.sceneParams.perspective+"px";Behave3d.vars.sceneContainer.style[Behave3d.vars.cssPropPerspectiveOrigin]=Behave3d.vars.sceneParams.perspective_origin_x+"% "+Behave3d.vars.sceneParams.perspective_origin_y+"%"};Behave3d.updateViewport=()=>{if(Behave3d.vars.sceneController)Behave3d.vars.sceneController.updateViewport()};Behave3d.mouseEventListener=e=>{if(e.type=="mousemove"){Behave3d.vars.mousePosX=e.pageX;Behave3d.vars.mousePosY=e.pageY}else if(e.type=="touchmove"){Behave3d.vars.mousePosX=e.changedTouches[0].pageX;Behave3d.vars.mousePosY=e.changedTouches[0].pageY}};Behave3d.registerController=(a,b)=>{if(Behave3d.controllers[a])Behave3d.debugOut("Controller with title '"+a+"' is registered again! Mind your references");if(b.prototype.requires){if(b.prototype.requires.controllers){var c=[];for(var i=0;i<b.prototype.requires.controllers.length;i++){var d=b.prototype.requires.controllers[i];if(!Behave3d[d])c.push(d)}if(c.length>0)Behave3d.debugExit("behave3d controller '"+a+"' requires the following controllers: "+c.join(", "))}}Behave3d.controllers[a]=b;b.prototype.title=a};Behave3d.updatePool=(a,b)=>{if(b===void 0)b=Behave3d.consts.BEHAVE3D_ATTRIB;Behave3d.debugOut("Engine - updating pool...");var c=Behave3d.vars.elementsPool,d=document.querySelectorAll("["+b+"]");for(var i=c.length-1;i>=0;i--){if(c[i].style&&!document.contains(c[i])){Behave3d.debugOut(c[i][Behave3d.consts.BEHAVE3D_PROPERTY].debugName()+" is removed from pool");c.splice(i,1)}}Behave3d.vars.delayedInits=[];for(var i=0;i<d.length;i++){if(!d[i][Behave3d.consts.BEHAVE3D_PROPERTY])new Behave3d.Element(d[i],!0,b)}Behave3d.doDelayedInits();if(!Behave3d.vars.sceneContainer)Behave3d(document.body).add("scene")};Behave3d.selector=(a,b)=>{if(b===void 0)b=!1;var c,d="";if(window.jQuery&&a instanceof jQuery)a=a[0];else if(typeof a=="string"&&(c=a.split(" ")).length==2){a=c[0];d=c[1]}else if(Array.isArray(a)){d=a[1];a=a[0]}var f=Behave3d.getDOMElement(a);if(!f)return!1;if(d!=""){if(!f[Behave3d.consts.BEHAVE3D_PROPERTY])Behave3d.debugExit("Cannot find controller '"+d+"' in element "+a+" - supplied element doesn't have Behave3d.Element");return f[Behave3d.consts.BEHAVE3D_PROPERTY].getController(d)||Behave3d.debugExit("Cannot find controller '"+d+"' in element "+a)}else{if(f[Behave3d.consts.BEHAVE3D_PROPERTY])return f[Behave3d.consts.BEHAVE3D_PROPERTY];if(!b)Behave3d.debugExit("Element "+a+" doesn't have Behave3d.Element");return new Behave3d.Element(f)}};Behave3d.doDelayedInits=()=>{if(!Behave3d.vars.delayedInits)return;["events","messages"].forEach(a=>{for(var i=0;i<Behave3d.vars.delayedInits.length;i++){var b=Behave3d.vars.delayedInits[i];if(b.controller.construct)b.controller.construct(b.params,a);b.controller.set(b.params,a)}});Behave3d.vars.delayedInits=!1};Behave3d.runThisFrame=()=>{if(Behave3d.vars.engineIsPaused)return;var a=Date.now(),b=0,c=1;if(Behave3d.vars.lastFrameTimestamp){b=(a-Behave3d.vars.lastFrameTimestamp)/Behave3d.vars.lastFrameSubframes;if(!Behave3d.vars.shortTermFrameDuration){Behave3d.vars.longTermFrameDuration=Behave3d.vars.shortTermFrameDuration=b}else if(b/Behave3d.vars.shortTermFrameDuration<=4){Behave3d.vars.longTermFrameDuration=b*Behave3d.consts.LONGTTERM_FRAME_DURATION_M+Behave3d.vars.longTermFrameDuration*(1-Behave3d.consts.LONGTTERM_FRAME_DURATION_M);Behave3d.vars.shortTermFrameDuration=b*Behave3d.consts.SHORTTERM_FRAME_DURATION_M+Behave3d.vars.shortTermFrameDuration*(1-Behave3d.consts.SHORTTERM_FRAME_DURATION_M)}c=Math.round(b/Behave3d.vars.longTermFrameDuration-Behave3d.consts.SUBFRAMES_PRECISION);c=Math.max(1,Math.min(Behave3d.consts.MAX_SUBFRAMES_PER_FRAME,c));if(c>1)Behave3d.debugOut("Engine runs "+c+" frames at once - last frame's duration = "+b.toFixed(1)+"ms, average = "+Behave3d.vars.longTermFrameDuration.toFixed(1)+"ms")}Behave3d.vars.lastFrameTimestamp=a;Behave3d.vars.lastFrameSubframes=c;do{if(Behave3d.consts.DEBUG){Behave3d.vars.debugInfo.count_behave3d_elements=0;Behave3d.vars.debugInfo.count_transformed_elements=0;Behave3d.vars.debugInfo.count_translations=0;Behave3d.vars.debugInfo.count_rotations=0;Behave3d.vars.debugInfo.count_scalings=0;Behave3d.vars.debugInfo.count_origins=0;Behave3d.vars.debugInfo.count_opacities=0}Behave3d.vars.elementsToRemove=[];for(var i=0;i<Behave3d.vars.elementsPool.length;i++){Behave3d.vars.elementsPool[i][Behave3d.consts.BEHAVE3D_PROPERTY].cleanTransforms()}for(var i=0;i<Behave3d.vars.elementsPool.length;i++){Behave3d.vars.elementsPool[i][Behave3d.consts.BEHAVE3D_PROPERTY].updateControllers()}for(var i=0;i<Behave3d.vars.elementsPool.length;i++){Behave3d.vars.elementsPool[i][Behave3d.consts.BEHAVE3D_PROPERTY].calcPhysics(!0);Behave3d.vars.elementsPool[i][Behave3d.consts.BEHAVE3D_PROPERTY].applyTransforms()}for(var i=0;i<Behave3d.vars.elementsToRemove.length;i++){Behave3d.vars.elementsPool.splice(Behave3d.vars.elementsPool.indexOf(Behave3d.vars.elementsToRemove[i]),1)}}while(--c>0);Behave3d.vars.frameTimerID=Behave3d.vars.frameTimerType=="raf"?window.requestAnimationFrame(Behave3d.runThisFrame):window.setTimeout(Behave3d.runThisFrame,Behave3d.vars.frameDuration);if(Behave3d.consts.DEBUG&&Behave3d.consts.DEBUG_STATS_CONTAINER){if(!Behave3d.vars.debug_box_ref){Behave3d.vars.debug_box_ref=document.getElementById(Behave3d.consts.DEBUG_STATS_CONTAINER);if(Behave3d.vars.debug_box_ref)Behave3d.vars.debug_box_ref.style.visibility="visible"}if(Behave3d.vars.debug_box_ref)Behave3d.vars.debug_box_ref.innerHTML="elements: "+Behave3d.vars.debugInfo.count_behave3d_elements+"<br/>"+"transformed: "+Behave3d.vars.debugInfo.count_transformed_elements+"<br/>"+"translations: "+Behave3d.vars.debugInfo.count_translations+"<br/>"+"rotations: "+Behave3d.vars.debugInfo.count_rotations+"<br/>"+"scalings: "+Behave3d.vars.debugInfo.count_scalings+"<br/>"+"origins: "+Behave3d.vars.debugInfo.count_origins+"<br/>"+"opacities: "+Behave3d.vars.debugInfo.count_opacities+"<br/>"+"frame duration: "+b.toFixed(1)+"<br/>"+"framerate long-term:  "+Behave3d.vars.longTermFrameDuration.toFixed(1)+"<br/>"+"framerate short-term: "+Behave3d.vars.shortTermFrameDuration.toFixed(1);else Behave3d.debugExit("!")}};Behave3d.params.parseItemsString=(a,b)=>{if(b===void 0)b=!1;var c=b?{}:[];if(a.trim()=="")return c;a=a.split("|");for(var d=0;d<a.length;d++){var f=a[d].trim(),g=f,j=b?{}:[];if(f.trim().substr(-1)==")"){var l=f.indexOf("(");if(l!=-1){g=f.substr(0,l).trim();j=Behave3d.params.parseParamsString(f.substring(l+1,f.length-1),b)}}if(b)c[g]=j;else c.push({title:g,params:j})}return c};Behave3d.params.parseParamsString=(a,b)=>{var c=a.split(","),d=b?{}:[];for(var f=0;f<c.length;f++){var g=c[f].trim(),j=g,l=!0;if(j=="")continue;var m=c[f].indexOf(":");if(m!=-1){j=c[f].substr(0,m).trim();l=c[f].substr(m+1).trim();if(Behave3d.params.isNumber(l))l=Number(l);else if(l.toLowerCase()=="true")l=!0;else if(l.toLowerCase()=="false")l=!1}if(b)d[j]=l;else d.push([j,l])}return d};Behave3d.params.getParamsAsArray=a=>{var b=[];for(var c in a){b.push([c,a[c]])}return b};Behave3d.params.getParamsAsObject=a=>{var b={};for(var i=0;i<a.length;i++){b[a[i][0]]=a[i][1]}return b};Behave3d.params.getItemsAsArray=a=>{var b=[];for(var c in a){b.push({title:c,params:Behave3d.params.getParamsAsArray(a[c])})}return b};Behave3d.params.getParam=(a,b,c)=>{if(c===void 0)c=!1;for(var i=0;i<a.length;i++){if(a[i][0]==b){var d=a[i][1];if(c)a.splice(i,1);return d}}return void 0};Behave3d.params.extendObject=(a,b,c)=>{if(c===void 0)c=!1;var d={};for(var f in a){d[f]=a[f]}for(var f in b){if(!c||d.hasOwnProperty(f))d[f]=b[f]}return d};Behave3d.params.isNumber=(value,only_integers)=>Number(only_integers?parseInt(value):parseFloat(value))==value;Behave3d.params.getLength=(a,b,c,d)=>{if(Behave3d.params.isNumber(a))return Number(a);var f="Invalid length parameter '"+a+"' - ";if(typeof a!="string")Behave3d.debugExit(f+"not a string, nor number");if(d&&Array.isArray(d)&&d.indexOf(a)>=0)return a;var g=100,j=0,l=2,m=a.substr(-1);if(m=="X"||m=="Y"||m=="Z"){b=m;a=a.substr(0,a.length-1);m=a.substr(-1)}else if(!b)Behave3d.debugExit(f+"no axis");var n=a.substr(-2),o=a.substr(-3);if(o=="rem"){l=3;g=Behave3d.vars.unitRem*100}else if(m=="%"){l=1;g=b=="X"?c.parentNode.clientWidth:b=="Y"?c.parentNode.clientHeight:Behave3d.vars.sceneParams.perspective}else if(n=="%p")g=b=="Y"?c.parentNode.clientHeight:c.parentNode.clientWidth;else if(n=="%o")g=b=="Y"?c.clientHeight:c.clientWidth;else if(n=="%d")g=b=="Y"?document.documentElement.clientHeight:document.documentElement.clientWidth;else if(n=="%v")g=b=="Y"?window.top.innerHeight:window.top.innerWidth;else if(m=="o"){l=1}else if(m=="p"){l=1;j=-(b=="Y"?c.offsetTop:c.offsetLeft)}else if(m=="d"){l=1;if(c)j=-Behave3d.getElementPos(c,!1,!0)[b.toLowerCase()]}else if(m=="v"){l=1;j=c?-Behave3d.getElementPos(c,!1,!0,!0)[b.toLowerCase()]:b=="Y"?window.pageYOffset:window.pageXOffset}else if(d&&!Array.isArray(d))return a;else Behave3d.debugExit(f+"unknown format");var p=j+Number(a.substr(0,a.length-l));if(!Behave3d.params.isNumber(p))Behave3d.debugExit(f+"not a number");return p*g/100};Behave3d.getDOMElement=a=>{var b=typeof a=="string"?document.getElementById(a):a;if(!b)Behave3d.debugExit("Cannot find HTML element '"+a+"'");else if(!b.nodeName&&!(b instanceof Window)&&!(b instanceof Document))Behave3d.debugExit("HTML element expected, another object type received");return b};Behave3d.getElementPos=(a,b,c,d)=>{if(b===void 0)b=!1;if(a==="@mouse")return{x:Behave3d.vars.mousePosX-(d?window.pageXOffset:0),y:Behave3d.vars.mousePosY-(d?window.pageYOffset:0),z:0};if(!(a=Behave3d.getDOMElement(a)))return!1;var f={x:0,y:0,z:0};if(c){var w=a.offsetWidth,h=a.offsetHeight,g=a;do{f.x+=a.offsetLeft-a.scrollLeft;f.y+=a.offsetTop-a.scrollTop;a=a.offsetParent;g=g.parentNode;while(g!=a){f.x-=g.scrollLeft;f.y-=g.scrollTop;g=g.parentNode}}while(a.offsetParent);if(d){f.x-=window.pageXOffset;f.y-=window.pageYOffset}if(b){f.x+=w/2;f.y+=h/2}}else{var j=a.getBoundingClientRect();f.x=j.left;f.y=j.top;if(!d){f.x+=window.pageXOffset;f.y+=window.pageYOffset}if(b){f.x+=j.width/2;f.y+=j.height/2}}return f};Behave3d.getAngle=(a,b)=>{var c=b.x-a.x,d=b.y-a.y,f=Math.atan2(d,c)*Behave3d.consts.RADIANS_TO_UNITS;if(f<0)f+=Behave3d.consts.ROTATE_ONE_TURN;return f};Behave3d.getFunctionByName=a=>{if(typeof a=="function")return a;if(!a)return null;var b=a.split("."),c=b.pop(),d=window;for(var i=0;i<b.length;i++){if(!d[b[i]])return null;else d=d[b[i]]}return typeof d[c]=="function"?d[c]:null};Behave3d.getAccForDisplacement=(a,b)=>{if(b===void 0)b=1/Behave3d.consts.FRAME_RATE;var c=b*b/2;return{x:a.x/c,y:a.y/c,z:a.z/c}};Behave3d.getAccForSpeed=(a,b)=>{if(b===void 0)b=1/Behave3d.consts.FRAME_RATE;return{x:a.x/b,y:a.y/b,z:a.z/b}};Behave3d.isAnglePassed=(a,b,c,d)=>{var f=(b-a)%d,g=(c-a)%d;if((b-c)*f<0)return!1;if(f>=0&&(g<0||g>f))return!0;if(f<=0&&(g>0||g<f))return!0;return!1};Behave3d.ease=(a,b,c,d,f,g)=>{function j(x,y){switch(y){case"ease":return 0.5-0.5*Math.cos(Math.PI*x);case"ease_in":return 1-Math.cos(0.5*Math.PI*x);case"ease_out":return-Math.cos(0.5*Math.PI*(1+x));default:Behave3d.debugExit("Unknown ease type '"+y+"' supplied to Behave3d.ease()");}}if(g===void 0)g="total";if(d==0)return a;if(a==0)return a;if(b=="linear"||c==0)return g=="total"?a*(f+1)/d:a;var l=(f+1)/d,m=j(l,b);if(g=="current")return a*(1+(m-1)*c);var n=d+b,o;if(!Behave3d.ease.steps_cache)Behave3d.ease.steps_cache={};if(!(o=Behave3d.ease.steps_cache[n])){o={steps:[],sums:[]};var p=0,q=j(0,b);for(var i=0;i<d;i++){var r=j((i+1)/d,b)-q;q=q+r;p+=r;o.steps.push(r);o.sums.push(p)}o.steps.push(p);Behave3d.ease.steps_cache[n]=o}if(g=="step"){var s=a*d,r=s*o.steps[f]/o.steps[d];return a*(1+(r/a-1)*c)}else{var t=a*o.sums[f]/o.steps[d],u=a*l;return u*(1+(t/u-1)*c)}};Behave3d.ease.easeTypes=["linear","ease","ease_in","ease_out"];Behave3d.ease.mirrorMap={linear:"linear",ease:"ease",ease_in:"ease_out",ease_out:"ease_in"};Behave3d.debugOut=a=>{if(Behave3d.consts.DEBUG)console.log("behave3d:  "+a)};Behave3d.debugExit=a=>{throw"behave3d:  "+a};Behave3d.Element=function(a,b,c){if(b===void 0)b=!0;if(c===void 0)c=Behave3d.consts.BEHAVE3D_ATTRIB;if(!(a=Behave3d.getDOMElement(a)))return!1;a[Behave3d.consts.BEHAVE3D_PROPERTY]=this;this.element=a;this.is_pooled=!1;this.controllers=[];this.transforms=[];this.last_transform_str="";this.last_origin_str="";this.last_style_str="";this.last_opacity_str="";this.pos={x:0,y:0,z:0};this.velocity={x:0,y:0,z:0};this.acc={x:0,y:0,z:0};this.physics_enabled=!1;if(b)this.addToPool();this.actions_controller=this.addController(Behave3d.controllerActions,{id:"a"});if(a.getAttribute&&c)this.add(a.getAttribute(c));this.configureDOMParents()};Behave3d.Element.required_core_controllers=["actions","scene"];Behave3d.Element.prototype={};Behave3d.Element.prototype.configureDOMParents=function(){var a=this.element;while(a=a.parentNode){if(a===Behave3d.vars.sceneContainer||a===document.body||!a.style)break;if(!a.style[Behave3d.vars.cssPropTransformStyle])a.style[Behave3d.vars.cssPropTransformStyle]="preserve-3d"}return this};Behave3d.Element.prototype.addToPool=function(){Behave3d.debugOut("Element - add to pool: "+this.debugName());if(Behave3d.vars.elementsPool.indexOf(this.element)>=0){Behave3d.debugOut("Skipped adding element to pool because its already there: "+this.debugName());return this}Behave3d.vars.elementsPool.push(this.element);this.is_pooled=!0;return this};Behave3d.Element.prototype.removeFromPool=function(){Behave3d.debugOut("Element - remove from pool: "+this.debugName());var a=Behave3d.vars.elementsPool.indexOf(this.element);if(a<0||!this.is_pooled)Behave3d.debugExit(this.debugName()+".removeFromPool() fails because element is not in the pool");this.removeAllControllers();Behave3d.vars.elementsToRemove.push(this.element);this.is_pooled=!1;return this};Behave3d.Element.prototype.add=function(a,b){if(!a)return b?[]:this;var c=typeof a=="string"?Behave3d.params.parseItemsString(a):a;if(!c)Behave3d.debugExit("Error in controllers definition for "+this.debugName()+": '"+a+"'");var d=Behave3d.vars.delayedInits===!1;Behave3d.vars.delayedInits=Behave3d.vars.delayedInits||[];var f=[];for(var g=0;g<c.length;g++){var j=this.addController(c[g].title,c[g].params);if(b)f.push(j)}if(d)Behave3d.doDelayedInits();return b?f:this};Behave3d.Element.prototype.addController=function(a,b){if(b===void 0)b=[];if(!Array.isArray(b))b=Behave3d.params.getParamsAsArray(b);var c;if((a==="actions"||a===Behave3d.controllerActions)&&this.controllers.length>0){c=this.actions_controller}else{var d=!1,f=!1;for(var i=0;i<b.length;i++){if(b[i][0]=="targets")d=!0;else if(b[i][0]=="owner")f=!0}if(!f)b.unshift(["owner",this]);if(!d)b.unshift(["targets",[this.element]]);if(typeof a=="string"&&!Behave3d.controllers[a]){var g="behave3d is attempting to instantiate unregistered controller '"+a+"'";if(Behave3d.Element.required_core_controllers.indexOf(a)>=0)g+="\nPlease make sure the definition files for the following controllers are included in your project as they are always used: "+Behave3d.Element.required_core_controllers.join(", ");Behave3d.debugExit(g)}var j=typeof a=="string"?Behave3d.controllers[a]:a;c=new j(b);this.controllers.push(c)}if(Behave3d.vars.delayedInits===!1){if(c.construct)c.construct(b,"events");c.set(b,"events");if(c.construct)c.construct(b,"messages");c.set(b,"messages")}else Behave3d.vars.delayedInits.push({controller:c,params:b});return c};Behave3d.Element.prototype.removeAllControllers=function(){for(var a=this.controllers.length-1;a>=0;a--){this.removeController(a)}};Behave3d.Element.prototype.removeController=function(a){var b;if((typeof a=="undefined"?"undefined":_typeof(a))=="object")b=this.getControllerIndex(a);else if(Behave3d.params.isNumber(a))b=a;else b=this.getController(a,!0);if(!this.controllers[b])Behave3d.debugExit(this.debugName()+".removeController("+((typeof a=="undefined"?"undefined":_typeof(a))=="object"?a.debugName():a)+") - cannot find controller in controllers list! controller_index="+b);a=this.controllers[b];Behave3d.debugOut("Controller - remove: "+a.debugName());a.fireEvent("remove");this.controllers.splice(b,1);if(a.destruct)a.destruct.call(a);a.disabled=!0;return this};Behave3d.Element.prototype.getControllerIndex=function(a){for(var b=0;b<this.controllers.length;b++){if(this.controllers[b]===a)return b}return-1};Behave3d.Element.prototype.getDOMElement=function(a,b){var c;if(typeof a=="string")a=a.toLowerCase();if(a==="@this")c=this.element;else if(a==="@parent")c=this.element.parentNode;else if(a==="@ancestor"){c=this.element.parentNode;while(c&&!Behave3d(c,!1)){c=c.parentNode}}else c=Behave3d.getDOMElement(a);return b?c[Behave3d.consts.BEHAVE3D_PROPERTY]:c};Behave3d.Element.prototype.forEachController=function(a,b,c,d){if(a)for(var f=0;f<this.controllers.length;f++){d.call(this.controllers[f])}if(b){var g;while((g=this.element.parentNode)&&g!=document){if(g[Behave3d.consts.BEHAVE3D_PROPERTY])g[Behave3d.consts.BEHAVE3D_PROPERTY].forEachController(!0,!1,!1,d)}}if(c){var j=this.childNodes?this.childNodes:this.element.childNodes;for(var l=0;l<j.length;l++){var m=j[l];if(m[Behave3d.consts.BEHAVE3D_PROPERTY])m[Behave3d.consts.BEHAVE3D_PROPERTY].forEachController(!0,!1,!0,d);else Behave3d.Element.prototype.forEachController.call(m,!1,!1,!0,d)}}};Behave3d.Element.prototype.getController=function(a,b){if(b===void 0)b=!1;for(var c=0;c<this.controllers.length;c++){if(this.controllers[c].id==a)return b?c:this.controllers[c]}return!1};Behave3d.Element.prototype.updateControllers=function(){if(Behave3d.consts.DEBUG)Behave3d.vars.debugInfo.count_behave3d_elements++;for(var a=0;a<this.controllers.length;a++){this.controllers[a].to_be_updated=!0}var b=!0;while(b){b=!1;for(var a=0;a<this.controllers.length;a++){var c=this.controllers[a],d=this.controllers.length;if(!c.to_be_updated)continue;if(c.event_handlers.frame)c.fireEvent("frame",{},"controller");if(!c.disabled&&c.update)c.update.call(c);c.to_be_updated=!1;if(b=d!=this.controllers.length)break}}};Behave3d.Element.prototype.message=function(a,b,c){if(c===void 0)c="local";var d=c=="global",f=c=="parents"||c=="p_and_c",g=c=="children"||c=="p_and_c",j=c=="local",l=0;if(j){this.actions_controller.message(a,b);l++}if(d)for(var m=0;m<Behave3d.vars.elementsPool.length;m++){l+=Behave3d.vars.elementsPool[m][Behave3d.consts.BEHAVE3D_PROPERTY].message(a,b,"local")}if(f){var n;while((n=this.element.parentNode)&&n!=document){if(n[Behave3d.consts.BEHAVE3D_PROPERTY])l+=n[Behave3d.consts.BEHAVE3D_PROPERTY].message(a,b,"local")}}if(g){var o=this.childNodes?this.childNodes:this.element.childNodes;for(var p=0;p<o.length;p++){var q=o[p];if(q[Behave3d.consts.BEHAVE3D_PROPERTY]){l+=q[Behave3d.consts.BEHAVE3D_PROPERTY].message(a,b,"local");l+=q[Behave3d.consts.BEHAVE3D_PROPERTY].message(a,b,"children")}else l+=Behave3d.Element.prototype.message.call(q,a,b,"children")}}return l};Behave3d.Element.prototype.show=function(a){this.message(a?"show_immediately":"show");return this};Behave3d.Element.prototype.hide=function(a){this.message(a?"hide_immediately":"hide");return this};Behave3d.Element.prototype.addTransform=function(a){this.transforms.push(a);return this};Behave3d.Element.prototype.cleanTransforms=function(){this.transforms.length=0;if(this.physics_enabled)this.acc.x=this.acc.y=this.acc.z=0;return this};Behave3d.Element.prototype.applyTransforms=function(){if(!this.element.style)return;var a=[],b=!1,c=!1,d="",f=0,g=0,j=0,l=0;for(var i=0;i<this.transforms.length;i++){var m=this.transforms[i];if(m.type===Behave3d.transforms.translate){m.dx=m.dx.toFixed(Behave3d.consts.PRECISION_TRANSLATE);m.dy=m.dy.toFixed(Behave3d.consts.PRECISION_TRANSLATE);m.dz=m.dz.toFixed(Behave3d.consts.PRECISION_TRANSLATE);a.push("translate3d("+m.dx+"px, "+m.dy+"px, "+m.dz+"px)");f++}else if(m.type===Behave3d.transforms.rotate){m.rx=m.rx.toFixed(Behave3d.consts.PRECISION_ROTATE);m.ry=m.ry.toFixed(Behave3d.consts.PRECISION_ROTATE);m.rz=m.rz.toFixed(Behave3d.consts.PRECISION_ROTATE);m.ra=m.ra.toFixed(Behave3d.consts.PRECISION_ROTATE_ANGLE);a.push("rotate3d("+m.rx+", "+m.ry+", "+m.rz+", "+m.ra+Behave3d.consts.ROTATE_UNIT+")");g++}else if(m.type===Behave3d.transforms.scale){m.sx=m.sx.toFixed(Behave3d.consts.PRECISION_SCALE);m.sy=m.sy.toFixed(Behave3d.consts.PRECISION_SCALE);m.sz=m.sz.toFixed(Behave3d.consts.PRECISION_SCALE);a.push("scale3d("+m.sx+", "+m.sy+", "+m.sz+")");j++}else if(m.type===Behave3d.transforms.origin){m.ox=m.ox.toFixed(Behave3d.consts.PRECISION_SCALE);m.oy=m.oy.toFixed(Behave3d.consts.PRECISION_SCALE);m.oz=m.oz.toFixed(Behave3d.consts.PRECISION_TRANSLATE);b=m}else if(m.type===Behave3d.transforms.flatten){c=m}else if(m.type===Behave3d.transforms.opacity){m.opacity=m.opacity.toFixed(Behave3d.consts.PRECISION_OPACITY);if(d=="")d=1;d*=m.opacity}}var n=a.join(" ");if(n!=this.last_transform_str){this.element.style[Behave3d.vars.cssPropTransform]=this.last_transform_str=n;if(Behave3d.consts.DEBUG){Behave3d.vars.debugInfo.count_transformed_elements++;Behave3d.vars.debugInfo.count_translations+=f;Behave3d.vars.debugInfo.count_rotations+=g;Behave3d.vars.debugInfo.count_scalings+=j}}var o=b?b.ox*100+"% "+b.oy*100+"% "+b.oz+"px":"";if(o!=this.last_origin_str)this.element.style[Behave3d.vars.cssPropTransformOrigin]=this.last_origin_str=o;var p=c&&c.flatten?"flat":"preserve-3d";if(p!=this.last_style_str)this.element.style[Behave3d.vars.cssPropTransformStyle]=this.last_style_str=p;if(d!==this.last_opacity_str){this.element.style.opacity=this.last_opacity_str=d;if(Behave3d.consts.DEBUG)Behave3d.vars.debugInfo.count_opacities++}};Behave3d.Element.prototype.getAccForSuddenStop=function(a){if(a===void 0)a=1/Behave3d.consts.FRAME_RATE;var v=this.velocity,b=this.acc,c=a;return{x:-b.x-v.x/c,y:-b.y-v.y/c,z:-b.z-v.z/c}};Behave3d.Element.prototype.calcPhysics=function(a,b){if(!this.physics_enabled)return;if(b===void 0)b=1/Behave3d.consts.FRAME_RATE;var c=this.pos,v=this.velocity,d=this.acc,f=b,g=f*f/2;if(!this.actions_controller.paused){var j=v.x*f+d.x*g,l=v.y*f+d.y*g,m=v.z*f+d.z*g;c.x+=j;c.y+=l;c.z+=m;v.x+=d.x*f;v.y+=d.y*f;v.z+=d.z*f}if(a)this.transforms.unshift({type:Behave3d.transforms.translate,dx:c.x,dy:c.y,dz:c.z})};Behave3d.Element.prototype.makeChildOfScene=function(){var a=Behave3d.getElementPos(this.element);Behave3d.vars.sceneContainer.appendChild(this.element);this.element.style.position="absolute";this.element.style.left=a.x+"px";this.element.style.top=a.y+"px"};Behave3d.Element.prototype.fireEvent=function(a,b,c){if(c===void 0)c="local";var d=c=="global",f=c=="parents"||c=="p_and_c",g=c=="children"||c=="p_and_c",j=c=="local",l=0;if(j&&!d)for(var m=0;m<this.controllers.length;m++){l+=this.controllers[m].fireEvent(a,b,"controller")}if(d)for(var n=0;n<Behave3d.vars.elementsPool.length;n++){l+=Behave3d.vars.elementsPool[n][Behave3d.consts.BEHAVE3D_PROPERTY].fireEvent(a,b,"local")}if(f){var o;while((o=this.element.parentNode)&&o!=document){if(o[Behave3d.consts.BEHAVE3D_PROPERTY])l+=o[Behave3d.consts.BEHAVE3D_PROPERTY].fireEvent(a,b,"local")}}if(g){var p=this.childNodes?this.childNodes:this.element.childNodes;for(var q=0;q<p.length;q++){var r=p[q];if(r[Behave3d.consts.BEHAVE3D_PROPERTY]){l+=r[Behave3d.consts.BEHAVE3D_PROPERTY].fireEvent(a,b,"local");l+=r[Behave3d.consts.BEHAVE3D_PROPERTY].fireEvent(a,b,"children")}else l+=Behave3d.Element.prototype.fireEvent.call(r,a,b,"children")}}return l};Behave3d.Element.prototype.debugName=function(){return this.element.nodeName+("#"+this.element.id)};Behave3d.Controller=function(a,b){if(a===void 0)a={};this.unique_id=Behave3d.vars.uniqueIDCounter++;this.id="";this.disabled=!1;this.paused=!1;this.params_changed=!1;this.targets=[];this.event_handlers={};this.owner=null;if(this.default_params)for(var c in this.default_params){this[c]=this.default_params[c]}this.set(a,"params");if(b)this.owner.physics_enabled=!0;Behave3d.debugOut("Controller - create: "+this.debugName());if(this.construct)this.construct(a,"params")};Behave3d.Controller.common_messages=["pause","unpause","enable","disable","params","remove"];Behave3d.Controller.prototype={};Behave3d.Controller.prototype.setParam=function(a,b,c){if(c===void 0)c="";if(typeof b=="string"&&b.toLowerCase()=="toggle"&&this.hasOwnProperty(a)&&typeof this[a]=="boolean")b=this[a]?!1:!0;var d=c==""||c=="message",f=d||c=="events",g=d||c=="messages",j=d||c=="params",l=d,m=c=="message";if(a=="paused"||a=="disabled"){var n=this[a];if(j)this[a]=b;if(l&&b!=n)this.fireEvent(b==1?a:a=="paused"?"unpaused":"enabled");return!0}else if(a.substr(-3)==" on"){if(f)this.on(b,a.substr(0,a.length-3).trim());return this}else if(Behave3d.Controller.common_messages.indexOf(a)>=0||this.messages&&this.messages.indexOf(a)>=0){if(g)this.message(a,b);return this}else if(this instanceof Behave3d.controllerActions&&!this.hasOwnProperty(a)){if(g)this.message(a,b);return this}if(j){if(["construct","destruct","message","update"].indexOf(a)>=0){var o=typeof b=="string"?Behave3d.getFunctionByName(b):b;if(typeof o=="function")this[a]=o;else Behave3d.debugExit("Controller "+this.debugName()+" received invalid param ("+b+") that cannot override method "+a+"(), function or function name is expected.")}else if(this.hasOwnProperty(a)){if(this instanceof Behave3d.controllerActions&&a=="id"&&b!="a"){Behave3d.debugExit("Controller "+this.debugName()+" is not allowed to have its id changed to "+b)}this[a]=b;this.params_changed=!0}else if(!m)Behave3d.debugExit("Controller "+this.debugName()+" received unknown param '"+a+"'")}return this};Behave3d.Controller.prototype.set=function(a,b){if(Array.isArray(a))for(var i=0;i<a.length;i++){this.setParam(a[i][0],a[i][1],b)}else{if(typeof a=="string")a=Behave3d.params.parseParamsString(a,!0);for(var c in a){this.setParam(c,a[c],b)}}return this};Behave3d.Controller.prototype.paramsHaveChanged=function(a){return this.params_changed&&(a||!(this.params_changed=!1))};Behave3d.Controller.prototype.setMessageParams=function(a,b){if(b===void 0)b={};else if((typeof b=="undefined"?"undefined":_typeof(b))=="object")this.set(b,"message");return b};Behave3d.Controller.prototype.message=function(a,b){this.handleCommonMessage(a,b);return this};Behave3d.Controller.prototype.handleCommonMessage=function(a,b){Behave3d.debugOut("Message received: '"+a+"' by "+this.debugName());if(this.disabled&&["enable","remove","params"].indexOf(a)==-1)return!0;if(this.messages&&this.messages.indexOf(a)>=0)return!1;this.setMessageParams(a,b);if(a=="pause"||a=="unpause")this.set({paused:a=="pause"});else if(a=="enable"||a=="disable")this.set({disabled:a=="disable"});else if(a=="params")this.set(b);else if(a=="remove")this.owner.removeController(this);else Behave3d.debugExit(this.debugName()+" received unknown message '"+a+"'");return!0};Behave3d.Controller.prototype.on=function(a,b,c){var d={element:this.owner,controller:this,event:""},f=[];if(Array.isArray(a)){for(var i=0;i<a.length;i++){f.push(this.on(a[i],b),!0)}return c?f:this}var g=(typeof a=="string"?a:""+a).split(" "),j=0,l=this.debugName()+".on('"+a+"', "+(typeof b=="string"?"'"+b+"'":"function()")+")";if(g.length>2&&g[1]=="after"){j=Number(g[0]);g.splice(0,2)}if(g.length==1){if(Behave3d.params.isNumber(g[0])){j=Number(g[0]);d.event=!0}else d.event=g[0]}else if(g.length==2){d.controller=this.owner.getController(g[0]);if(!d.controller)Behave3d.debugExit(l+": cannot find controller '"+g[0]+"'");d.event=g[1]}else if(g.length==3){var m=[];if(g[0]=="@targets")for(var i=0;i<this.targets.length;i++){m.push(this.getTarget(i))}else m.push(this.owner.getDOMElement(g[0],!0));for(var i=0;i<m.length;i++){f.push({element:m[i],controller:m[i].getController(g[1])||Behave3d.debugExit(l+": cannot find controller '"+g[1]+"'"),event:g[2]})}}if(f.length==0)f.push(d);var n=typeof b=="string"?function(p,q){this.message(b,q)}.bind(this):b.bind(this),o=j?(p,q)=>{window.setTimeout(()=>{n(p,q)},j)}:n;for(var i=0;i<f.length;i++){if(f[i].event===!0){o();Behave3d.debugOut("Delay trigger created: "+l)}else f[i].controller.addEventHandler(f[i].event,o)}if(c)return f.length>1?f:f[0];else return this};Behave3d.Controller.prototype.off=function(a,b){if(Array.isArray(a))for(var i=0;i<a.length;i++){this.off(a[i],b)}if(b)this.removeEventHandler(a,b);else delete this.event_handlers[a];return this};Behave3d.Controller.prototype.addEventHandler=function(a,b){if(!this.event_handlers[a])this.event_handlers[a]=[];this.event_handlers[a].push(b);Behave3d.debugOut("Handler created: '"+a+"' on "+this.debugName())};Behave3d.Controller.prototype.removeEventHandler=function(a,b){if(!this.event_handlers[a])return;var c=this.event_handlers[a];if(c.indexOf(b)>=0){for(var i=c.length-1;i>=0;i--){if(c[i]===b)c.splice(i,1)}Behave3d.debugOut("Handler removed: '"+a+"' on "+this.debugName())}};Behave3d.Controller.prototype.relayEvents=function(a,b){for(var c in b){(function(d,f,g){this.on(d,j=>{g.fireEvent(b[d],j)})}).bind(this)(c,b[c],a)}};Behave3d.Controller.prototype.fireEvent=function(a,b,c){if(c===void 0)c="controller";if(c=="controller"){var d=(this.event_handlers[a]?this.event_handlers[a]:[]).concat(this.event_handlers.all?this.event_handlers.all:[]);for(var f=0;f<d.length;f++){d[f].call(this,a,b)}return d.length}else return this.owner.fireEvent(a,b,c)};Behave3d.Controller.prototype.getAnotherController=function(a){var b=a.split(" ");if(b.length==1)return this.owner.getController(a)||Behave3d.debugExit(this.debugName+" cannot find another controller with id = '"+a+"'");else return Behave3d(a,!1)};Behave3d.Controller.prototype.getComputedLengths=function(a,b,c,d){var f={};for(var i=0;i<a.length;i++){f[a[i]]=Behave3d.params.getLength(this[a[i]],"X",this.owner.element,d)}if(b)for(var i=0;i<b.length;i++){f[b[i]]=Behave3d.params.getLength(this[b[i]],"Y",this.owner.element,d)}if(c)for(var i=0;i<c.length;i++){f[c[i]]=Behave3d.params.getLength(this[c[i]],"Z",this.owner.element,d)}return f};Behave3d.Controller.prototype.getTarget=function(a){return this.targets[a][Behave3d.consts.BEHAVE3D_PROPERTY]};Behave3d.Controller.prototype.makeTargetsDom3d=function(a){if(a===void 0)a=!0;for(var b=0;b<this.targets.length;b++){var c=this.targets[b];if(!c[Behave3d.consts.BEHAVE3D_PROPERTY])new Behave3d.Element(c,a)}return this};Behave3d.Controller.prototype.registerActions=function(a,b,c){function d(y,z,A){var B=y[z];y[z]=y[A];y[A]=B}if(!a)return this;var f=0,g="",j=!1;if(typeof a=="string"&&a.length>0){var l=a.split(" ");if(l[0]=="reverse"){j=!0;l=l.splice(1)}f=Number(l[0]);g=l[1]||""}else if(typeof a=="number")f=a;var m=g?g+" ":"",n=(f?f+" after ":"")+m;if(typeof b=="string"){var o=b.split(" "),p=[];if(o.indexOf("showhide")>=0)p=p.concat(["show","hide","show_immediately","hide_immediately"]);b={};for(var i=0;i<p.length;i++){b[p[i]]=p[i]}}if(j){for(var q in b){if(q=="show")d(b,"show","hide");else if(q=="show_immediately")d(b,"show_immediately","hide_immediately")}for(var r in c){if(r=="show_start")d(c,"show_start","hide_start");else if(r=="show_end")d(c,"show_end","hide_end")}}for(var q in b){var s=q.substr(-12)=="_immediately";this.on((s?m:n)+"a "+q,b[q])}if(typeof c=="string"){var t=c.split(" "),u=[];if(t.indexOf("showhide")>=0)u=u.concat(["show_start","show_end","hide_start","hide_end"]);c={};for(var i=0;i<u.length;i++){c[u[i]]=u[i]}}var x=(g?this.owner.getDOMElement(g,!0):this.owner).actions_controller;for(var r in c){(function(y,z,A){if(!Array.isArray(z))z=[z];for(var i=0;i<z.length;i++){this.on(z[i],B=>{A.fireEvent(y,B)})}}).bind(this)(r,c[r],x)}this.actions_registered=!0;return this};Behave3d.Controller.prototype.setSubcontrollersEvents=function(a){this.on("paused",function(){for(var i=0;i<a.length;i++){a[i].set({paused:this.paused})}})};Behave3d.Controller.prototype.setChildTargets=function(a,b){if(a===void 0)a=-1;if(b===void 0)b=!0;var c=[],d=[],f={removed:[],inserted:[]},g=[];for(var i=0;i<this.owner.element.childNodes.length;i++){if(a!=-1&&g.length>=a)break;var j=this.owner.element.childNodes[i];if(j.nodeType==Node.ELEMENT_NODE)g.push(j)}for(var i=0;i<this.targets.length;i++){if(this.targets[i]!=this.owner.element&&g.indexOf(this.targets[i])==-1){c.push([i,this.targets[i]]);Behave3d(this.targets[i]).removeFromPool()}}this.targets=g;for(var i=0;i<this.targets.length;i++){if(!this.targets[i][Behave3d.consts.BEHAVE3D_PROPERTY]){new Behave3d.Element(this.targets[i],b);d.push([i,this.targets[i]])}}for(var i=0;i<c.length;i++){var l=[c[i][1]],k=i+1;while(c[k]&&c[k][0]==c[i][0]+k-i){l.push(c[k][1]);k++}f.removed.push({first_pos:i,last_pos:k-1,elements:l});i=k-1}for(var i=0;i<d.length;i++){var l=[d[i][1]],k=i+1;while(d[k]&&d[k][0]==d[i][0]+k-i){l.push(d[k][1]);k++}f.inserted.push({first_pos:i,last_pos:k-1,elements:l});i=k-1}return f};Behave3d.Controller.prototype.addTransform=function(a,b){if(b===void 0)for(var c=0;c<this.targets.length;c++){this.getTarget(c).addTransform(a)}else this.getTarget(b).addTransform(a);return this};Behave3d.Controller.prototype.applySpringForce=function(a,b,c,d){if(b==0)return;if(d===void 0||d==-1){for(var i=0;i<this.targets.length;i++){this.applySpringForce(a,b,c,i)}return}var f=this.getTarget(d),g=f.pos,j=f.acc,l=a.x-g.x,m=a.y-g.y,n=a.z-g.z;if(c!=0){var o=Math.sqrt(l*l+m*m+n*n),p=o/c,q=f.getAccForSuddenStop(),r=Math.min(1,p*p*p*p);j.x+=q.x*r;j.y+=q.y*r;j.z+=q.z*r}j.x+=l*b;j.y+=m*b;j.z+=n*b};Behave3d.Controller.prototype.applyGravityForce=function(a,b,c,d){if(b==0)return;if(d===void 0||d==-1){for(var i=0;i<this.targets.length;i++){this.applyGravityForce(a,b,c,i)}return}b*=Behave3d.consts.GRAVITY_CONSTANT;var f=this.getTarget(d),g=f.pos,j=f.acc,l=(a.x-g.x)*c,m=(a.y-g.y)*c,n=(a.z-g.z)*c,o=Math.sqrt(l*l+m*m+n*n),p=b/o;if(o>=5*c){j.x+=p*l/o;j.y+=p*m/o;j.z+=p*n/o}};Behave3d.Controller.prototype.applySpeedDamping=function(a,b){if(a==1)return;if(b===void 0||b==-1){for(var i=0;i<this.targets.length;i++){this.applySpeedDamping(a,i)}return}var c=this.getTarget(b),v=c.velocity;v.x*=this.damping_factor;v.y*=this.damping_factor;v.z*=this.damping_factor};Behave3d.Controller.prototype.getPathPos=a=>{var b={x:0,y:0,z:0};for(var i=0;i<a.length;i++){if(a[i].disabled)continue;b.x+=a[i].path_pos.x;b.y+=a[i].path_pos.y;b.z+=a[i].path_pos.z}return b};Behave3d.Controller.prototype.debugName=function(){return(this.owner?this.owner.debugName():"UnassignedController")+":"+this.id+"(#"+this.unique_id+" "+this.title+")"};Behave3d.StepEngine=function(a,b,c,d){this.is_circular=b;this.events_controller=c||null;this.options=d||{};this.var_names=Object.keys(a);this.vars={};this.lagged_vars={};this.vars_speeds={};for(var f in a){this.vars[f]=a[f];this.lagged_vars[f]=a[f];this.vars_speeds[f]=0}if(this.var_names.length==0)Behave3d.debugExit("Behave3d.StepEngine() contructor received empty 'vars' object");for(var g in Behave3d.StepEngine.default_options){if(this.options[g]===void 0)this.options[g]=Behave3d.StepEngine.default_options[g]}if(this.is_circular){if(this.options.marked_angle===void 0)this.options.marked_angle=-1;if(this.options.cycle_len===void 0)this.options.cycle_len=Behave3d.consts.ROTATE_ONE_TURN}this.stop()};Behave3d.StepEngine.events=["start","half","end","start_back","half_back","end_back","pos0","pos1","cycle","mark","cycle_back","mark_back"];Behave3d.StepEngine.default_options={ease_type:"linear",ease_amount:1,ease_mirror:!1,half_step:1,spring_acc:0,spring_vdamp:1,always_fire_start_end:!0};Behave3d.StepEngine.prototype={};Behave3d.StepEngine.prototype.getVar=function(a,b){return b?this.vars[a]:this.lagged_vars[a]};Behave3d.StepEngine.prototype.setVar=function(a,b,c){this.vars[a]=b;if(!c){this.lagged_vars[a]=b;this.vars_speeds[a]=0}};Behave3d.StepEngine.prototype.stop=function(){this.direction=0;this.pos=0};Behave3d.StepEngine.prototype.setMovement=function(a,b,c){if(c===void 0)c=!0;this.direction=0;this.duration=b;if(c||!this.movement_start){this.movement_start={};this.movement_end={};this.pos=0;this.starting_angle=this.vars[this.var_names[0]];for(var d in this.vars){this.movement_start[d]=this.vars[d];this.movement_end[d]=this.vars[d]+a[d]}}return!0};Behave3d.StepEngine.prototype.isMoving=function(){return this.direction!=0};Behave3d.StepEngine.prototype.start=function(a,b,c,d,f){if(a===void 0)a=1;if(b===void 0)b=!1;if(c===void 0)c=!0;if(d)this.setMovement(d,f,c);var g=a==1?this.movement_start:this.movement_end,j=a==1?this.movement_end:this.movement_start;if(b&&this.movement_start)for(var l in this.vars){this.vars[l]=g[l]}this.current_movement={};this.current_start={};for(var l in this.vars){this.current_movement[l]=j[l]-this.vars[l];this.current_start[l]=this.vars[l]}if(this.pos<0)this.pos=0;else if(this.pos>1)this.pos=1;this.movement_dpos=b||c?1:a==1?1-this.pos:this.pos;if(this.movement_dpos>0||this.options.always_fire_start_end){this.total_frames=Math.round(this.duration*this.movement_dpos/Behave3d.vars.frameDuration);this.frames_left=this.total_frames;this.direction=a;this.events_suffix=this.direction==-1?"_back":"";this.current_ease=this.ease_mirror&&this.direction==-1?Behave3d.ease.mirrorMap[this.options.ease_type]:this.options.ease_type;if(this.total_frames==0)this.update(!1)}else this.direction=0;return!0};Behave3d.StepEngine.prototype.update=function(a){var b=!1;if(!a&&this.direction!=0){var c={};for(var d in this.vars){c[d]=this.vars[d]}for(var d in this.vars){this.vars[d]=this.current_start[d]+Behave3d.ease(this.current_movement[d],this.current_ease,this.options.ease_amount,this.total_frames,this.total_frames-this.frames_left,"total")}if(this.events_controller&&this.frames_left==this.total_frames)this.events_controller.fireEvent("start"+this.events_suffix);if(this.events_controller&&this.frames_left==Math.floor(this.total_frames/2))this.events_controller.fireEvent("half"+this.events_suffix);if(this.is_circular){if(this.options.cycle_len>0&&this.frames_left<this.total_frames){var d=this.var_names[0];if(Behave3d.isAnglePassed(this.starting_angle,this.vars[d],c[d],this.options.cycle_len))this.events_controller.fireEvent("cycle"+this.events_suffix)}if(this.options.marked_angle!=-1){var d=this.var_names[0];if(Behave3d.isAnglePassed(this.options.marked_angle,this.vars[d],c[d],this.options.cycle_len))this.events_controller.fireEvent("mark"+this.events_suffix)}}if(this.frames_left>0){this.frames_left--;this.pos+=this.direction*this.movement_dpos/this.total_frames}if(this.frames_left==0){for(var d in this.vars){this.vars[d]=this.direction==1?this.movement_end[d]:this.movement_start[d]}this.pos=this.direction==1?1:0;this.direction=0;if(this.events_controller){this.events_controller.fireEvent("end"+this.events_suffix);this.events_controller.fireEvent("pos"+this.pos)}b=!0}}if(this.options.half_step!=1)for(var d in this.vars){this.lagged_vars[d]+=(this.vars[d]-this.lagged_vars[d])*this.options.half_step}if(this.options.spring_acc!=0){for(var d in this.vars){this.vars_speeds[d]+=(this.vars[d]-this.lagged_vars[d])*this.options.spring_acc;this.vars_speeds[d]*=this.options.spring_vdamp;this.lagged_vars[d]+=this.vars_speeds[d]}}if(this.options.half_step==1&&this.options.spring_acc==0)for(var d in this.vars){this.lagged_vars[d]=this.vars[d]}return b};Behave3d.startEngine();