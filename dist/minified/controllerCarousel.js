"use strict";Behave3d.controllerCarousel=function(a){Behave3d.Controller.call(this,a)};Behave3d.controllerCarousel.prototype=Object.create(Behave3d.Controller.prototype);Behave3d.controllerCarousel.prototype.requires={controllers:["controllerList"]};Behave3d.controllerCarousel.prototype.messages=["update","reset","focus"];Behave3d.controllerCarousel.prototype.events=["start","end","change"];Behave3d.controllerCarousel.prototype.default_params={list:"",radius:200,radius_z:-1,dz:-1,plane_angle:0,back_scale:1,back_opacity:1,middle_opacity:1,duration:700,ease_type:"ease",ease_amount:1,use_spring:!0,acc:30,damping_factor:0.9};Behave3d.controllerCarousel.prototype.construct=function(a,b){if(b=="params"){this.stepper=new Behave3d.StepEngine({angle:0},!0,this,this);this.message("reset")}else if(b=="events"){this.handlers_set_for_list="";this.setEventHandlers()}};Behave3d.controllerCarousel.prototype.destruct=()=>{};Behave3d.controllerCarousel.prototype.message=function(a,b){if(this.handleCommonMessage(a,b))return this;b=this.setMessageParams(a,b);if(a=="update"){if(!this.list)Behave3d.debugExist(this.debugName()+" cannot update because its property 'list' is not set");this.setEventHandlers();var c=this.setItems(b);this.stepper.setVar("angle",this.target_angle=this.items_dangle*this.current_item)}else if(a=="reset"){this.current_item=0;this.target_item=0;this.target_angle=0}else if(a=="focus"){this.target_item=b.focused;this.target_angle=this.target_angle+this.items_dangle*b.step;this.stepper.setMovement({angle:this.target_angle-this.stepper.getVar("angle",!0)},this.duration);this.stepper.start()}return this};Behave3d.controllerCarousel.prototype.update=function(){if(this.stepper.update(this.paused)){this.current_item=this.target_item;this.fireEvent("change",{pos:this.current_item,item:this.targets[this.current_item]})}if(this.paramsHaveChanged()||!this.computed_params)this.computed_params=this.getComputedLengths(["radius"],[],["radius_z","dz"]);var a=this.computed_params.radius_z==-1?this.computed_params.radius:this.computed_params.radius_z,b=this.computed_params.dz==-1?a:this.computed_params.dz;for(var i=0;i<this.targets.length;i++){var c=this.getItemPos(i,this.stepper.getVar("angle")),d=c.z;c.z+=b;if(this.use_spring){this.applySpringForce(c,this.acc,0,i);this.applySpeedDamping(this.damping_factor,i);var e=this.getTarget(i).pos;d=e.z-b}else{this.addTransform({type:Behave3d.transforms.translate,dx:c.x,dy:c.y,dz:c.z},i)}if(this.back_scale!=1){var f=1-(1-this.back_scale)*(a-d)/(2*a);this.addTransform({type:Behave3d.transforms.scale,sx:f,sy:f,sz:1},i)}if(this.back_opacity!=1||this.middle_opacity!=1){var g=d>=0?1-(1-this.middle_opacity)*(a-d)/a:this.middle_opacity-(this.middle_opacity-this.back_opacity)*-d/a;this.addTransform({type:Behave3d.transforms.opacity,opacity:g},i)}}};Behave3d.controllerCarousel.prototype.setEventHandlers=function(){if(this.list!=this.handlers_set_for_list){this.on(this.list+" update","update");this.on(this.list+" reset","reset");this.on(this.list+" focus","focus");this.handlers_set_for_list=this.list;this.list_ref=this.getAnotherController(this.list)}};Behave3d.controllerCarousel.prototype.setItems=function(){this.targets=this.list_ref.targets;this.items_dangle=Behave3d.consts.ROTATE_ONE_TURN/this.targets.length;var a=this.owner.element.clientWidth/2,b=this.owner.element.clientHeight/2;for(var i=0;i<this.targets.length;i++){var c=this.getTarget(i);c.element.style.position="absolute";c.element.style.left=a-this.targets[i].clientWidth/2+"px";c.element.style.top=b-this.targets[i].clientHeight/2+"px";c.element.style.transformOrigin="50% 50% 0px";if(this.use_spring)c.physics_enabled=!0}};Behave3d.controllerCarousel.prototype.getItemPos=function(a,b){var c=-b+a*this.items_dangle,d=this.computed_params.radius_z==-1?this.computed_params.radius:this.computed_params.radius_z,e={x:Math.sin(c/Behave3d.consts.RADIANS_TO_UNITS)*this.computed_params.radius,y:0,z:Math.cos(c/Behave3d.consts.RADIANS_TO_UNITS)*d};if(this.plane_angle!=0){e.y=e.x*Math.sin(this.plane_angle/Behave3d.consts.RADIANS_TO_UNITS);e.x=e.x*Math.cos(this.plane_angle/Behave3d.consts.RADIANS_TO_UNITS)}return e};Behave3d.registerController("carousel",Behave3d.controllerCarousel);