"use strict";Behave3d.controllerOpacity=function(a){Behave3d.Controller.call(this,a)};Behave3d.controllerOpacity.prototype=Object.create(Behave3d.Controller.prototype);Behave3d.controllerOpacity.prototype.events=["start_fade_in","end_fade_in","start_fade_out","end_fade_out","show","hide"];Behave3d.controllerOpacity.prototype.messages=["fade_in","fade_out","show","hide"];Behave3d.controllerOpacity.prototype.default_params={opacity:1,duration:1000,affect:"",register_actions:!1,ease_type:"ease",ease_amount:1,ease_mirror:!1};Behave3d.controllerOpacity.prototype.construct=function(a,b){if(b=="params"){this.current_action="";this.total_frames=0;this.frames_left=0;this.current_opacity=this.opacity;this.actions_registered=!1}else if(b=="events"){this.setEventHandlers()}};Behave3d.controllerOpacity.prototype.message=function(a,b){if(this.handleCommonMessage(a,b))return this;b=this.setMessageParams(a,b);var c=a=="show"||a=="hide";this.current_action=a;this.target_opacity=a=="fade_out"||a=="hide"?0:this.opacity;this.total_frames=c?0:Math.round(this.duration/Behave3d.vars.frameDuration);if(this.total_frames==0){this.total_frames=1;c=!0}this.frames_left=this.total_frames;this.ostep=(this.target_opacity-this.current_opacity)/this.total_frames;if(this.affect=="display"&&this.current_opacity!=0&&this.target_opacity==0){this.display_style=[];for(var i=0;i<this.targets.length;i++){var d=this.targets[i].style.display||window.getComputedStyle(this.targets[i],null).getPropertyValue("display");this.display_style.push(d)}}if(this.affect!=""&&this.current_opacity==0&&this.target_opacity!=0)for(var i=0;i<this.targets.length;i++){if(this.affect=="visibility")this.targets[i].style.visibility="visible";else if(this.affect=="display"&&this.display_style)this.targets[i].style.display=this.display_style[i]}if(c)this.update(!0);return this};Behave3d.controllerOpacity.prototype.update=function(a){if(!this.paused&&this.frames_left>0){var b=this.current_action=="show"||this.current_action=="hide";if(this.frames_left==this.total_frames){if(b)this.fireEvent(this.current_action);else this.fireEvent("start_"+this.current_action)}this.current_opacity+=Behave3d.ease(this.ostep,this.ease_type,this.ease_amount,this.total_frames,this.total_frames-this.frames_left,"step");this.frames_left--;if(this.frames_left==0){if(!b)this.fireEvent("end_"+this.current_action);this.current_opacity=this.target_opacity;this.current_action="";if(this.current_opacity==0)for(var i=0;i<this.targets.length;i++){if(this.affect=="visibility")this.targets[i].style.visibility="hidden";else if(this.affect=="display")this.targets[i].style.display="none"}}}if(!a)this.addTransform({type:Behave3d.transforms.opacity,opacity:this.current_opacity})};Behave3d.controllerOpacity.prototype.setEventHandlers=function(){this.registerActions(this.register_actions,{show:"fade_in",hide:"fade_out",show_immediately:"show",hide_immediately:"hide"},{show_start:["show","fade_in_start"],show_end:["show","fade_in_end"],hide_start:["hide","fade_out_start"],hide_end:["hide","fade_out_end"]})};Behave3d.registerController("opacity",Behave3d.controllerOpacity);