"use strict";Behave3d.controllerList=function(a){Behave3d.Controller.call(this,a)};Behave3d.controllerList.prototype=Object.create(Behave3d.Controller.prototype);Behave3d.controllerList.prototype.messages=["update","reset","insert","remove","focus_pos","focus_first","focus_last","focus_next","focus_prev","focus_step","select","unselect"];Behave3d.controllerList.prototype.events=["update","reset","focus","select","first_reached","last_reached","border_left","no_prev","no_next"];Behave3d.controllerList.prototype.default_params={items:"children",circular:!0,select_multiple:!1};Behave3d.controllerList.prototype.construct=function(a,b){if(b=="params"){this.focused=-1;this.selected=-1}};Behave3d.controllerList.prototype.destruct=()=>{};Behave3d.controllerList.prototype.message=function(a,b){if(this.handleCommonMessage(a,b))return this;b=this.setMessageParams(a,b);if(a=="update"){var c=this.setItems();this.fireEvent("update",c);if(this.focused==-1)this.message("reset");if(!this.circular){if(this.focused==0)this.fireEvent("first_reached");else if(this.focused==this.targets.length-1)this.fireEvent("last_reached")}return this}else if(a=="reset"){this.focused=!this.targets||this.targets.length==0?-1:0;this.selected=this.select_multiple?[]:-1;this.fireEvent("reset");return this}else if(a.substr(0,6)=="focus_"){var d=this.focused,e=0;if(this.targets.length==0)d=-1;else if(a=="focus_pos")d=b.pos;else if(a=="focus_first")d=0;else if(a=="focus_last")d=this.targets.length-1;else if(a=="focus_next")e=1;else if(a=="focus_prev")e=-1;else if(a=="focus_step")e=b.step;if(e!=0){if(this.circular)d=(d+e+this.targets.length)%this.targets.length;else if(d+e>=this.targets.length)this.fireEvent("no_next");else if(d+e<0)this.fireEvent("no_prev");else d+=e}if(d!=this.focused&&this.targets[d]){var f=this.focused;this.focused=d;this.fireEvent("focus",{focused:this.focused,step:e});if(!this.circular){if(f==0||f==this.targets.length-1)this.fireEvent("border_left");if(this.focused==0)this.fireEvent("first_reached");else if(this.focused==this.targets.length-1)this.fireEvent("last_reached")}}return this}else if(a=="select"||a=="unselect"){var g=b.pos!==void 0?b.pos:this.focused,h=this.select_multiple?this.selected.indexOf(g):this.selected==g?0:-1;if(g>=0&&g<this.targets.length){if(a=="select"&&h==-1){if(this.select_multiple)this.selected.push(g);else this.selected=g}else if(a=="unselect"&&h!=-1){if(this.select_multiple)this.selected.splice(h);else this.selected=-1}this.fireEvent("select",{selected:this.selected})}}return this};Behave3d.controllerList.prototype.setItems=function(){var a,b=this.focused!=-1?this.targets[this.focused]:null;if(this.items=="children")a=this.setChildTargets();else Behave3d.debugExit("Behave3d.controllerList.setItems() cannot handle this.items = '"+this.items+"'");if(this.focused>=this.targets.length)this.focused=this.targets.length-1;else if(this.focused<0)this.focused=this.targets.length>0?0:-1;else if(this.targets[this.focused]!==b){var c=this.targets.indexOf(b);if(c>=0)this.focused=c;else if(this.focused>=this.targets.length)this.focused=this.targets.length-1;else if(this.focused<0)this.focused=this.targets.length>0?0:-1;else{c=this.focused;for(var i=0;i<a.removed.length;i++){var d=a.removed[i];c-=d.last_pos-d.first_pos+1;if(this.focused>=d.first_pos&&this.focused<=d.last_pos){c+=d.last_pos-this.focused;break}}for(var i=0;i<a.inserted.length;i++){var e=a.inserted[i];if(e.first_pos<=c)c+=e.first_pos-e.last_pos+1}this.focused=c}}return a};Behave3d.registerController("list",Behave3d.controllerList);