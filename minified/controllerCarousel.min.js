"use strict";Behave3d.controllerCarousel=function(t){Behave3d.Controller.call(this,t)},Behave3d.controllerCarousel.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerCarousel.prototype.requires={controllers:["controllerList"]},Behave3d.controllerCarousel.prototype.messages=["update","reset","focus"],Behave3d.controllerCarousel.prototype.events=["start","end","change"],Behave3d.controllerCarousel.prototype.default_params={list:"",radius:200,radius_z:-1,dz:-1,plane_angle:0,back_scale:1,back_opacity:1,middle_opacity:1,duration:700,ease_type:"ease",ease_amount:1,use_spring:!0,acc:30,damping_factor:.9},Behave3d.controllerCarousel.prototype.construct=function(t,e){"params"==e?(this.stepper=new Behave3d.StepEngine({angle:0},!0,this,this),this.message("reset")):"events"==e&&(this.handlers_set_for_list="",this.setEventHandlers())},Behave3d.controllerCarousel.prototype.destruct=function(){},Behave3d.controllerCarousel.prototype.message=function(t,e){if(this.handleCommonMessage(t,e))return this;if(e=this.setMessageParams(t,e),"update"==t){this.list||Behave3d.debugExist(this.debugName()+" cannot update because its property 'list' is not set"),this.setEventHandlers();this.setItems(e);this.stepper.setVar("angle",this.target_angle=this.items_dangle*this.current_item)}else"reset"==t?(this.current_item=0,this.target_item=0,this.target_angle=0):"focus"==t&&(this.target_item=e.focused,this.target_angle=this.target_angle+this.items_dangle*e.step,this.stepper.setMovement({angle:this.target_angle-this.stepper.getVar("angle",!0)},this.duration),this.stepper.start());return this},Behave3d.controllerCarousel.prototype.update=function(){this.stepper.update(this.paused)&&(this.current_item=this.target_item,this.fireEvent("change",{pos:this.current_item,item:this.targets[this.current_item]})),(this.paramsHaveChanged()||!this.computed_params)&&(this.computed_params=this.getComputedLengths(["radius"],[],["radius_z","dz"]));for(var t=-1==this.computed_params.radius_z?this.computed_params.radius:this.computed_params.radius_z,e=-1==this.computed_params.dz?t:this.computed_params.dz,s=0;s<this.targets.length;s++){var a=this.getItemPos(s,this.stepper.getVar("angle")),r=a.z;if(a.z+=e,this.use_spring){this.applySpringForce(a,this.acc,0,s),this.applySpeedDamping(this.damping_factor,s);var i=this.getTarget(s).pos;r=i.z-e}else this.addTransform({type:Behave3d.transforms.translate,dx:a.x,dy:a.y,dz:a.z},s);if(1!=this.back_scale){var o=1-(1-this.back_scale)*(t-r)/(2*t);this.addTransform({type:Behave3d.transforms.scale,sx:o,sy:o,sz:1},s)}if(1!=this.back_opacity||1!=this.middle_opacity){var h=r>=0?1-(1-this.middle_opacity)*(t-r)/t:this.middle_opacity-(this.middle_opacity-this.back_opacity)*-r/t;this.addTransform({type:Behave3d.transforms.opacity,opacity:h},s)}}},Behave3d.controllerCarousel.prototype.setEventHandlers=function(){this.list!=this.handlers_set_for_list&&(this.on(this.list+" update","update"),this.on(this.list+" reset","reset"),this.on(this.list+" focus","focus"),this.handlers_set_for_list=this.list,this.list_ref=this.getAnotherController(this.list))},Behave3d.controllerCarousel.prototype.setItems=function(){this.targets=this.list_ref.targets,this.items_dangle=Behave3d.consts.ROTATE_ONE_TURN/this.targets.length;for(var t=this.owner.element.clientWidth/2,e=this.owner.element.clientHeight/2,s=0;s<this.targets.length;s++){var a=this.getTarget(s);a.element.style.position="absolute",a.element.style.left=t-this.targets[s].clientWidth/2+"px",a.element.style.top=e-this.targets[s].clientHeight/2+"px",a.element.style.transformOrigin="50% 50% 0px",this.use_spring&&(a.physics_enabled=!0)}},Behave3d.controllerCarousel.prototype.getItemPos=function(t,e){var s=-e+t*this.items_dangle,a=-1==this.computed_params.radius_z?this.computed_params.radius:this.computed_params.radius_z,r={x:Math.sin(s/Behave3d.consts.RADIANS_TO_UNITS)*this.computed_params.radius,y:0,z:Math.cos(s/Behave3d.consts.RADIANS_TO_UNITS)*a};return 0!=this.plane_angle&&(r.y=r.x*Math.sin(this.plane_angle/Behave3d.consts.RADIANS_TO_UNITS),r.x=r.x*Math.cos(this.plane_angle/Behave3d.consts.RADIANS_TO_UNITS)),r},Behave3d.registerController("carousel",Behave3d.controllerCarousel);