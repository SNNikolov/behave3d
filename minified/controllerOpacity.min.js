"use strict";Behave3d.controllerOpacity=function(t){Behave3d.Controller.call(this,t)},Behave3d.controllerOpacity.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerOpacity.prototype.events=["start_fade_in","end_fade_in","start_fade_out","end_fade_out","show","hide"],Behave3d.controllerOpacity.prototype.messages=["fade_in","fade_out","show","hide"],Behave3d.controllerOpacity.prototype.default_params={opacity:1,duration:1e3,affect:"",register_actions:!1,ease_type:"ease",ease_amount:1,ease_mirror:!1},Behave3d.controllerOpacity.prototype.construct=function(t,e){"params"==e?(this.current_action="",this.total_frames=0,this.frames_left=0,this.current_opacity=this.opacity,this.actions_registered=!1):"events"==e&&this.setEventHandlers()},Behave3d.controllerOpacity.prototype.message=function(t,e){if(this.handleCommonMessage(t,e))return this;e=this.setMessageParams(t,e);var i="show"==t||"hide"==t;if(this.current_action=t,this.target_opacity="fade_out"==t||"hide"==t?0:this.opacity,this.total_frames=i?0:Math.round(this.duration/Behave3d.vars.frameDuration),0==this.total_frames&&(this.total_frames=1,i=!0),this.frames_left=this.total_frames,this.ostep=(this.target_opacity-this.current_opacity)/this.total_frames,"display"==this.affect&&0!=this.current_opacity&&0==this.target_opacity){this.display_style=[];for(var s=0;s<this.targets.length;s++){var a=this.targets[s].style.display||window.getComputedStyle(this.targets[s],null).getPropertyValue("display");this.display_style.push(a)}}if(""!=this.affect&&0==this.current_opacity&&0!=this.target_opacity)for(var s=0;s<this.targets.length;s++)"visibility"==this.affect?this.targets[s].style.visibility="visible":"display"==this.affect&&this.display_style&&(this.targets[s].style.display=this.display_style[s]);return i&&this.update(!0),this},Behave3d.controllerOpacity.prototype.update=function(t){if(!this.paused&&this.frames_left>0){var e="show"==this.current_action||"hide"==this.current_action;if(this.frames_left==this.total_frames&&(e?this.fireEvent(this.current_action):this.fireEvent("start_"+this.current_action)),this.current_opacity+=Behave3d.ease(this.ostep,this.ease_type,this.ease_amount,this.total_frames,this.total_frames-this.frames_left,"step"),this.frames_left--,0==this.frames_left&&(e||this.fireEvent("end_"+this.current_action),this.current_opacity=this.target_opacity,this.current_action="",0==this.current_opacity))for(var i=0;i<this.targets.length;i++)"visibility"==this.affect?this.targets[i].style.visibility="hidden":"display"==this.affect&&(this.targets[i].style.display="none")}t||this.addTransform({type:Behave3d.transforms.opacity,opacity:this.current_opacity})},Behave3d.controllerOpacity.prototype.setEventHandlers=function(){this.registerActions(this.register_actions,{show:"fade_in",hide:"fade_out",show_immediately:"show",hide_immediately:"hide"},{show_start:["show","fade_in_start"],show_end:["show","fade_in_end"],hide_start:["hide","fade_out_start"],hide_end:["hide","fade_out_end"]})},Behave3d.registerController("opacity",Behave3d.controllerOpacity);