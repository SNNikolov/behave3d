"use strict";Behave3d.controllerProperty=function(t){Behave3d.Controller.call(this,t)},Behave3d.controllerProperty.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerProperty.prototype.events=["start","half","end","start_back","half_back","end_back","pos0","pos1"],Behave3d.controllerProperty.prototype.messages=["start","start_back","start_reverse","start_new","start_new_back","pos0","pos1"],Behave3d.controllerProperty.prototype.default_params={name:"",val:"same",dval:0,init_val:"same",is_v_coo:!1,suffix:"",precision:0,duration:1e3,half_step:1,spring_acc:0,spring_vdamp:.92,ease_type:"ease",ease_amount:1,ease_mirror:!1,read_on_start:!1,repeat_start_pos:!1,register_actions:!1},Behave3d.controllerProperty.prototype.construct=function(t,e){if("params"==e){this.property_container=this.targets[0],this.container_name="";var r=this.name.split(".");if(2==r.length&&(this.name=r[1],this.container_name=r[0],this.property_container=this.property_container[this.container_name]),"#"==this.suffix)var s="same"===this.init_val?this.readValue():this.getColorObject(this.init_val);else var a="same"===this.init_val?this.readValue():Behave3d.params.getLength(this.init_val,this.is_v_coo?"Y":"X",this.owner.element,["same"]),s={val:a};this.stepper=new Behave3d.StepEngine(s,!1,this,this),this.last_val=void 0}else"events"==e&&this.setEventHandlers()},Behave3d.controllerProperty.prototype.message=function(t,e){if(this.handleCommonMessage(t,e))return this;e=this.setMessageParams(t,e),this.direction="start"==t||"start_new"==t||"pos1"==t||"start_reverse"==t&&1!=this.direction?1:-1;var r="pos0"==t||"pos1"==t?0:this.duration,s="start_new"==t||"start_new_back"==t;if(this.read_on_start){var a=this.readValue();if("#"==this.suffix){var o=this.stepper.getVar("colR")!=a.colR||this.stepper.getVar("colG")!=a.colG||this.stepper.getVar("colB")!=a.colB;o&&(this.stepper.setVar("colR",a.colR),this.stepper.setVar("colG",a.colG),this.stepper.setVar("colB",a.colB))}else{var o=this.stepper.getVar("val")!=a;o&&this.stepper.setVar("val",a)}}var i=void 0!==e.val&&void 0===e.dval;if("#"==this.suffix)var n="same"===this.val?this.val:this.getColorObject(this.val),h=0===this.dval?this.dval:this.getColorObject(this.dval),l={colR:i||0===h?"same"===n?0:n.colR-this.stepper.getVar("colR",!0):h.colR,colG:i||0===h?"same"===n?0:n.colG-this.stepper.getVar("colG",!0):h.colG,colB:i||0===h?"same"===n?0:n.colB-this.stepper.getVar("colB",!0):h.colB};else var n=Behave3d.params.getLength(this.val,this.is_v_coo?"Y":"X",this.owner.element,["same"]),h=Behave3d.params.getLength(this.dval,this.is_v_coo?"Y":"X",this.owner.element),l={val:i||0==h?"same"===n?0:n-this.stepper.getVar("val",!0):h};return this.stepper.start(this.direction,this.repeat_start_pos,s,l,r),this.paused=!1,this},Behave3d.controllerProperty.prototype.update=function(){if(this.stepper.update(this.paused),"#"==this.suffix)var t=this.getColorHex({colR:this.stepper.getVar("colR").toFixed(0),colG:this.stepper.getVar("colG").toFixed(0),colB:this.stepper.getVar("colB").toFixed(0)});else{var t=this.stepper.getVar("val").toFixed(this.precision);t==-0&&(t=0),t+=this.suffix}if(t!==this.last_val){for(var e=0;e<this.targets.length;e++)(this.container_name?this.targets[e][this.container_name]:this.targets[e])[this.name]=t;this.last_val=t}},Behave3d.controllerProperty.prototype.setEventHandlers=function(){this.registerActions(this.register_actions,{show:"start_back",hide:"start",show_immediately:"pos0",hide_immediately:"pos1"},{show_start:"start_back",show_end:"end_back",hide_start:"start",hide_end:"end",move_start:"start",move_end:"end"})},Behave3d.controllerProperty.prototype.readValue=function(){var t=this.property_container[this.name];return""===t&&this.property_container==this.owner.element.style&&(t=window.getComputedStyle(this.owner.element,null).getPropertyValue(this.name)),"#"==this.suffix?this.getColorObject(t.substr(1)):("string"==typeof t&&this.suffix&&(t=t.substr(0,t.length-this.suffix.length)),Number(t))},Behave3d.controllerProperty.prototype.getColorObject=function(t){var e=parseInt(t.substr(1,2),16),r=parseInt(t.substr(3,2),16),s=parseInt(t.substr(5,2),16);return{colR:e,colG:r,colB:s}},Behave3d.controllerProperty.prototype.getColorHex=function(t){var e=Number(Math.max(0,Math.min(t.colR,255))).toString(16),r=Number(Math.max(0,Math.min(t.colG,255))).toString(16),s=Number(Math.max(0,Math.min(t.colB,255))).toString(16);return 1==e.length&&(e="0"+e),1==r.length&&(r="0"+r),1==s.length&&(s="0"+s),"#"+e+r+s},Behave3d.registerController("property",Behave3d.controllerProperty);