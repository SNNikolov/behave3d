"use strict";Behave3d.controllerProperty=function(t){Behave3d.Controller.call(this,t)},Behave3d.controllerProperty.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerProperty.prototype.events=["start","half","end","start_back","half_back","end_back","pos0","pos1"],Behave3d.controllerProperty.prototype.messages=["start","start_back","start_reverse","start_new","start_new_back","pos0","pos1"],Behave3d.controllerProperty.prototype.default_params={name:"",val:"same",dval:0,init_val:"same",is_v_coo:!1,suffix:"",precision:0,duration:1e3,half_step:1,spring_acc:0,spring_vdamp:.92,ease_type:"ease",ease_amount:1,ease_mirror:!1,read_on_start:!1,repeat_start_pos:!1,register_actions:!1},Behave3d.controllerProperty.prototype.construct=function(t,e){if("params"==e){this.property_container=this.targets[0],this.container_name="";var r=this.name.split(".");2==r.length&&(this.name=r[1],this.container_name=r[0],this.property_container=this.property_container[this.container_name]);var s=Behave3d.params.getLength(this.init_val,this.is_v_coo?"X":"Y",this.owner.element,["same"]);"same"===s&&(s=this.readValue()),this.stepper=new Behave3d.StepEngine({val:s},!1,this,this),this.last_val=void 0}else"events"==e&&this.setEventHandlers()},Behave3d.controllerProperty.prototype.message=function(t,e){var r=void 0!==e.val&&void 0===e.dval;if(this.handleCommonMessage(t,e))return this;e=this.setMessageParams(t,e),this.direction="start"==t||"start_new"==t||"pos1"==t||"start_reverse"==t&&1!=this.direction?1:-1;var s="pos0"==t||"pos1"==t?0:this.duration,a="start_new"==t||"start_new_back"==t;if(this.read_on_start){var o=this.readValue(),i=this.stepper.getVar("val")!=o;i&&this.stepper.setVar("val",o)}var n=Behave3d.params.getLength(this.val,this.is_v_coo?"X":"Y",this.owner.element,["same"]),h=Behave3d.params.getLength(this.dval,this.is_v_coo?"X":"Y",this.owner.element),p=r||0==h?"same"===n?0:n-this.stepper.getVar("val",!0):h;return this.stepper.start(this.direction,this.repeat_start_pos,a,{val:p},s),this.paused=!1,this},Behave3d.controllerProperty.prototype.update=function(){this.stepper.update(this.paused);var t=this.stepper.getVar("val").toFixed(this.precision);if(t==-0&&(t=0),t!==this.last_val){for(var e=0;e<this.targets.length;e++)(this.container_name?this.targets[e][this.container_name]:this.targets[e])[this.name]=t+this.suffix;this.last_val=t}},Behave3d.controllerProperty.prototype.setEventHandlers=function(){this.registerActions(this.register_actions,{show:"start_back",hide:"start",show_immediately:"pos0",hide_immediately:"pos1"},{show_start:"start_back",show_end:"end_back",hide_start:"start",hide_end:"end",move_start:"start",move_end:"end"})},Behave3d.controllerProperty.prototype.readValue=function(){var t=this.property_container[this.name];return""===t&&this.property_container==this.owner.element.style&&(t=window.getComputedStyle(this.owner.element,null).getPropertyValue(this.name)),"string"==typeof t&&this.suffix&&(t=t.substr(0,t.length-this.suffix.length)),Number(t)},Behave3d.registerController("property",Behave3d.controllerProperty);