"use strict";Behave3d.controllerList=function(e){Behave3d.Controller.call(this,e)},Behave3d.controllerList.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerList.prototype.messages=["update","reset","insert","remove","focus_pos","focus_first","focus_last","focus_next","focus_prev","focus_step","select","unselect"],Behave3d.controllerList.prototype.events=["update","reset","focus","select","first_reached","last_reached","border_left","no_prev","no_next"],Behave3d.controllerList.prototype.default_params={items:"children",circular:!0,select_multiple:!1},Behave3d.controllerList.prototype.construct=function(e,t){"params"==t&&(this.focused=-1,this.selected=-1)},Behave3d.controllerList.prototype.destruct=function(){},Behave3d.controllerList.prototype.message=function(e,t){if(this.handleCommonMessage(e,t))return this;if(t=this.setMessageParams(e,t),"update"==e){var s=this.setItems();return this.fireEvent("update",s),-1==this.focused&&this.message("reset"),this.circular||(0==this.focused?this.fireEvent("first_reached"):this.focused==this.targets.length-1&&this.fireEvent("last_reached")),this}if("reset"==e)return this.focused=this.targets&&0!=this.targets.length?0:-1,this.selected=this.select_multiple?[]:-1,this.fireEvent("reset"),this;if("focus_"==e.substr(0,6)){var i=this.focused,r=0;if(0==this.targets.length?i=-1:"focus_pos"==e?i=t.pos:"focus_first"==e?i=0:"focus_last"==e?i=this.targets.length-1:"focus_next"==e?r=1:"focus_prev"==e?r=-1:"focus_step"==e&&(r=t.step),0!=r&&(this.circular?i=(i+r+this.targets.length)%this.targets.length:i+r>=this.targets.length?this.fireEvent("no_next"):0>i+r?this.fireEvent("no_prev"):i+=r),i!=this.focused&&this.targets[i]){var h=this.focused;this.focused=i,this.fireEvent("focus",{focused:this.focused,step:r}),this.circular||((0==h||h==this.targets.length-1)&&this.fireEvent("border_left"),0==this.focused?this.fireEvent("first_reached"):this.focused==this.targets.length-1&&this.fireEvent("last_reached"))}return this}if("select"==e||"unselect"==e){var o=void 0!==t.pos?t.pos:this.focused,l=this.select_multiple?this.selected.indexOf(o):this.selected==o?0:-1;o>=0&&o<this.targets.length&&("select"==e&&-1==l?this.select_multiple?this.selected.push(o):this.selected=o:"unselect"==e&&-1!=l&&(this.select_multiple?this.selected.splice(l):this.selected=-1),this.fireEvent("select",{selected:this.selected}))}return this},Behave3d.controllerList.prototype.setItems=function(){var e,t=-1!=this.focused?this.targets[this.focused]:null;if("children"==this.items?e=this.setChildTargets():Behave3d.debugExit("Behave3d.controllerList.setItems() cannot handle this.items = '"+this.items+"'"),this.focused>=this.targets.length)this.focused=this.targets.length-1;else if(this.focused<0)this.focused=this.targets.length>0?0:-1;else if(this.targets[this.focused]!==t){var s=this.targets.indexOf(t);if(s>=0)this.focused=s;else if(this.focused>=this.targets.length)this.focused=this.targets.length-1;else if(this.focused<0)this.focused=this.targets.length>0?0:-1;else{s=this.focused;for(var i=0;i<e.removed.length;i++){var r=e.removed[i];if(s-=r.last_pos-r.first_pos+1,this.focused>=r.first_pos&&this.focused<=r.last_pos){s+=r.last_pos-this.focused;break}}for(var i=0;i<e.inserted.length;i++){var h=e.inserted[i];h.first_pos<=s&&(s+=h.first_pos-h.last_pos+1)}this.focused=s}}return e},Behave3d.registerController("list",Behave3d.controllerList);