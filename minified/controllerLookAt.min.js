"use strict";Behave3d.controllerLookAt=function(e){Behave3d.Controller.call(this,e)},Behave3d.controllerLookAt.prototype=Object.create(Behave3d.Controller.prototype),Behave3d.controllerLookAt.prototype.events=["start","end"],Behave3d.controllerLookAt.prototype.messages=[],Behave3d.controllerLookAt.prototype.default_params={target_id:"",quickness:.2,face_angle:0,event_precision:1,target_dz:0},Behave3d.controllerLookAt.prototype.construct=function(e,t){"params"==t&&(this.current_angle=0,this.current_angle_z=0)},Behave3d.controllerLookAt.prototype.update=function(){if(this.paramsHaveChanged()&&(this.computed_params=this.getComputedLengths([],[],["target_dz"])),!this.paused){var e=Behave3d.getElementPos(this.owner.element,!0),t=Behave3d.getElementPos(this.target_id,!0),r=Behave3d.getAngle(e,t)+this.face_angle,s=r-this.current_angle;s<-Behave3d.consts.ROTATE_ONE_TURN/2&&(s+=Behave3d.consts.ROTATE_ONE_TURN),s>Behave3d.consts.ROTATE_ONE_TURN/2&&(s-=Behave3d.consts.ROTATE_ONE_TURN),this.current_angle=(Behave3d.consts.ROTATE_ONE_TURN+this.current_angle+s*this.quickness)%Behave3d.consts.ROTATE_ONE_TURN;var a=Math.abs(r-this.current_angle)<this.event_precision,n=Math.abs(s)<this.event_precision;if(0!=this.computed_params.target_dz){var o=t.x-e.x,h=t.y-e.y,_=Math.sqrt(o*o+h*h),r=Behave3d.getAngle({x:0,y:0},{x:this.computed_params.target_dz,y:_}),s=r-this.current_angle_z;s<-Behave3d.consts.ROTATE_ONE_TURN/2&&(s+=Behave3d.consts.ROTATE_ONE_TURN),s>Behave3d.consts.ROTATE_ONE_TURN/2&&(s-=Behave3d.consts.ROTATE_ONE_TURN),this.current_angle_z=(Behave3d.consts.ROTATE_ONE_TURN+this.current_angle_z+s*this.quickness)%Behave3d.consts.ROTATE_ONE_TURN,a=a&&Math.abs(r-this.current_angle_z)<this.event_precision,n=n&&Math.abs(s)<this.event_precision}n&&!a?this.fireEvent("start"):a&&!n&&this.fireEvent("end")}0!=this.computed_params.target_dz?this.addTransform({type:Behave3d.transforms.rotate,rx:-Math.sin(this.current_angle/Behave3d.consts.RADIANS_TO_UNITS),ry:Math.cos(this.current_angle/Behave3d.consts.RADIANS_TO_UNITS),rz:0,ra:this.current_angle_z}):this.addTransform({type:Behave3d.transforms.rotate,rx:0,ry:0,rz:1,ra:this.current_angle})},Behave3d.registerController("lookAt",Behave3d.controllerLookAt);